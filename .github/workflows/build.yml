
name: Build QMK Firmware

on:
  push:
    branches:
      - main  # または master

jobs:
  build:
    runs-on: ubuntu-latest
    container: qmkfm/qmk_cli

    steps:
      - name: Checkout qmk/qmk_firmware
        uses: actions/checkout@v4
        with:
          repository: qmk/qmk_firmware
          path: qmk_firmware

      - name: Checkout user keymap
        uses: actions/checkout@v4
        with:
          path: user_keymap

      - name: Setup QMK
        working-directory: qmk_firmware
        run: |
          qmk setup -y

      - name: Symlink keymap
        run: |
          ln -s /github/workspace/user_keymap/keyboard/keymap /github/workspace/qmk_firmware/keyboards/keyboard/keymaps/keymap

      - name: Build firmware
        working-directory: qmk_firmware
        run: |
          qmk compile -kb keyboard -km keymap

      - name: Upload UF2 file
        uses: actions/upload-artifact@v4
        with:
          name: qmk-firmware
          path: qmk_firmware/.build/keyboard_keymap.uf2
